-- APZ.XX Custom Copier üíæüîê
-- v1.5 - Universal Exploit Support + Writefile Compatibility

local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local HttpService = game:GetService("HttpService")
local MarketplaceService = game:GetService("MarketplaceService")
local TweenService = game:GetService("TweenService")

local LP = Players.LocalPlayer
local Clock = os.clock
local function ts(s) return string.format("‚è± %.2fs", Clock() - s) end

-- GUI Setup
local gui = Instance.new("ScreenGui")
gui.Name = "APZ_XX_Custom_Copier"
gui.ResetOnSpawn = false
if syn and syn.protect_gui then
    syn.protect_gui(gui)
    gui.Parent = CoreGui
elseif gethui then
    gui.Parent = gethui()
else
    gui.Parent = CoreGui
end

local mainFrame = Instance.new("Frame", gui)
mainFrame.Size = UDim2.new(0, 480, 0, 300)
mainFrame.Position = UDim2.new(0.5, -240, 0.5, -150)
mainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
mainFrame.BackgroundTransparency = 0.05
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Name = "MainFrame"

local titleBar = Instance.new("TextLabel", mainFrame)
titleBar.Size = UDim2.new(1, 0, 0, 40)
titleBar.BackgroundColor3 = Color3.fromRGB(30,30,30)
titleBar.Text = "üíæ APZ.XX Custom Copier üîê"
titleBar.TextColor3 = Color3.new(1,1,1)
titleBar.Font = Enum.Font.Code
titleBar.TextSize = 20

local closeButton = Instance.new("TextButton", mainFrame)
closeButton.Size = UDim2.new(0, 40, 0, 40)
closeButton.Position = UDim2.new(1, -40, 0, 0)
closeButton.Text = "‚ùå"
closeButton.BackgroundColor3 = Color3.fromRGB(60,0,0)
closeButton.MouseButton1Click:Connect(function()
    gui:Destroy()
end)

local minimizeButton = Instance.new("TextButton", mainFrame)
minimizeButton.Size = UDim2.new(0, 40, 0, 40)
minimizeButton.Position = UDim2.new(1, -80, 0, 0)
minimizeButton.Text = "‚ûñ"
minimizeButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)

local minimized = false
minimizeButton.MouseButton1Click:Connect(function()
    minimized = not minimized
    for _,v in ipairs(mainFrame:GetChildren()) do
        if v:IsA("TextLabel") or v:IsA("TextButton") or v:IsA("TextBox") then
            if v ~= titleBar and v ~= closeButton and v ~= minimizeButton then
                v.Visible = not minimized
            end
        end
    end
end)

local passwordBox = Instance.new("TextBox", mainFrame)
passwordBox.Size = UDim2.new(0.8, 0, 0, 40)
passwordBox.Position = UDim2.new(0.1, 0, 0, 60)
passwordBox.PlaceholderText = "Enter Password üîë"
passwordBox.Font = Enum.Font.Code
passwordBox.TextColor3 = Color3.new(1,1,1)
passwordBox.BackgroundColor3 = Color3.fromRGB(40,40,40)

local statusLabel = Instance.new("TextLabel", mainFrame)
statusLabel.Size = UDim2.new(1, 0, 0, 30)
statusLabel.Position = UDim2.new(0, 0, 0, 110)
statusLabel.Text = "üí° Waiting for action..."
statusLabel.TextColor3 = Color3.new(1,1,1)
statusLabel.Font = Enum.Font.Code
statusLabel.TextScaled = true
statusLabel.BackgroundTransparency = 1

local startButton = Instance.new("TextButton", mainFrame)
startButton.Size = UDim2.new(0.5, 0, 0, 40)
startButton.Position = UDim2.new(0.25, 0, 0, 150)
startButton.Text = "üíæ Save / Copy Game"
startButton.Font = Enum.Font.Code
startButton.TextColor3 = Color3.new(1,1,1)
startButton.BackgroundColor3 = Color3.fromRGB(0,100,0)

-- File Naming
local function safe(r) return r:GetFullName():gsub("[^%w_]", "_") end
local function genFile(base, ext)
    local ok, info = pcall(function() return MarketplaceService:GetProductInfo(game.PlaceId) end)
    local name = (ok and info.Name or "UnknownGame"):gsub("%W","_")
    local id = tostring(game.GameId):sub(1,8)
    local f = string.format("apzsaves_%s_%s.%s", name, id, ext)
    local i, try = 1, f
    while isfile and isfile(try) do
        try = string.format("%s_%d.%s", f:sub(1,#f-#ext-1), i, ext)
        i += 1
    end
    return try
end

-- Dump Scripts
local function dumpScripts()
    local scripts = {}
    for _, obj in ipairs(game:GetDescendants()) do
        if obj:IsA("LocalScript") or obj:IsA("ModuleScript") or obj:IsA("Script") then
            pcall(function()
                scripts[obj:GetFullName()] = obj.Source
            end)
        end
    end
    writefile(genFile("scripts", "json"), HttpService:JSONEncode(scripts))
end

-- Game Copier
local function copyFullGame()
    statusLabel.Text = "üì¶ Saving full game..."
    local ok, save = pcall(function()
        return loadstring(game:HttpGet("https://raw.githubusercontent.com/luau/UniversalSynSaveInstance/main/saveinstance.lua"))()
    end)
    if ok then
        save({
            FileName = genFile("FULL_GAME", "rbxlx"),
            SaveScript = true,
            SaveInstance = true,
            Decompile = true,
            IncludeWorkspace = true,
            IncludeLighting = true,
            IncludeReplicatedFirst = true,
            IncludeReplicatedStorage = true,
            IncludeServerScriptService = true,
            IncludeServerStorage = true,
            IncludeStarterGui = true,
            IncludeStarterPack = true,
            IncludeSoundService = true,
            IncludeTeams = true
        })
        dumpScripts()
        statusLabel.Text = "‚úÖ Game + Scripts Saved!"
        local tween = TweenService:Create(statusLabel, TweenInfo.new(0.5, Enum.EasingStyle.Bounce), {
            TextColor3 = Color3.fromRGB(100,255,100)
        })
        tween:Play()
    else
        statusLabel.Text = "‚ùå Failed to save game."
        local tween = TweenService:Create(statusLabel, TweenInfo.new(0.5, Enum.EasingStyle.Bounce), {
            TextColor3 = Color3.fromRGB(255,100,100)
        })
        tween:Play()
    end
end

-- Start Logic
startButton.MouseButton1Click:Connect(function()
    if passwordBox.Text ~= "APZ_PAID" then
        statusLabel.Text = "üîí Wrong Password!"
        return
    end
    statusLabel.Text = "‚öôÔ∏è Copying full game..."
    task.wait(1)
    copyFullGame()
    task.wait(1)
    statusLabel.Text = "üéâ Done! Game copied."
end)
